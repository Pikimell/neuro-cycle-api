# Функціональні можливості серверу (MVP для застосунку NeuroCycle)

- Авторизація та аутентифікація: реєстрація/логін через Cognito, оновлення токенів, обов’язкова перевірка токена на кожен запит, зберігання профілю користувача та його ролі (PATIENT/DOCTOR/ADMIN).
- Профіль користувача: CRUD для базових даних користувача, пацієнта та лікаря; перегляд закріпленого лікаря, його контактів і робочого часу.
- Емоційний стан: щоденне опитування зі шкалою настрою (повзунок смайликів), збереження оцінки та коментаря, отримання поточного стану для головної картки та історії для статистики/календаря.
- Рекомендації та задачі: видача рекомендацій для користувачів без діагнозу; для користувачів із діагнозом — відображення опитувань, які треба пройти (questionnaire templates + questions/responses).
- Напади мігрені: створення запису про напад (потенційні тригери, тривалість, інтенсивність, локалізація, аура тощо), перегляд/редагування/видалення, відображення на календарі та детальному перегляді дня.
- Щоденник симптомів: отримання агрегованих даних настрою, нападів і нотаток по днях; детальний перегляд дня з усією активністю.
- Ліки та нагадування: CRUD для медикаментів і нагадувань, отримання списку нагадувань, відмітка “прийняв/не прийняв” дозу (оновлення lastTakenAt).
- Записи на прийом: створення запиту пацієнтом, сповіщення лікаря, лікар підтверджує/призначає час; пацієнт бачить статуси (REQUESTED/CONFIRMED/DECLINED/CANCELLED/COMPLETED).
- Алгоритмічні дані та діагнози: зберігання хронічних станів, алергій, особливих застережень; доступ лікаря згідно з прапорцями видимості.
- Упорядковані опитування: CRUD для шаблонів опитувань, питань та відповідей; можливість для лікаря призначити опитування пацієнту й отримувати відповіді.
- Логи/аналітика: логування запитів, помилок; можливість друку дерева маршрутів (dev); базовий CORS/JSON/cookie middleware.

# Опис моделей бази даних NeuroCycle

Нижче наведено опис основних моделей бази даних для бекенду NeuroCycle.  
Кожна модель представлена у вигляді таблиці з полями: **назва властивості**,
**тип**, **опис**.

---

## 1. Модель `User` (користувач)

| Назва властивості | Тип      | Опис                                 |
| ----------------- | -------- | ------------------------------------ |
| id                | objectId | Унікальний ідентифікатор користувача |
| email             | string   | Логін користувача (email)            |
| passwordHash      | string   | Хеш пароля                           |
| role              | enum     | Роль: `PATIENT`, `DOCTOR`, `ADMIN`   |
| isActive          | boolean  | Чи активний акаунт                   |
| createdAt         | datetime | Дата створення акаунта               |
| updatedAt         | datetime | Дата останнього оновлення            |

---

## 2. Модель `Patient` (профіль пацієнта)

| Назва властивості | Тип      | Опис                                                     |
| ----------------- | -------- | -------------------------------------------------------- |
| id                | objectId | Унікальний ідентифікатор профілю пацієнта                |
| userId            | objectId | Посилання на `User`                                      |
| fullName          | string   | Повне ім’я пацієнта                                      |
| dateOfBirth       | date     | Дата народження                                          |
| sex               | enum     | Стать: `MALE`, `FEMALE`, `OTHER`, `UNSPECIFIED`          |
| phone             | string   | Номер телефону                                           |
| diagnosisType     | enum     | `NONE`, `EPISODIC_MIGRAINE`, `CHRONIC_MIGRAINE`, `OTHER` |
| assignedDoctorId  | objectId | Поточний лікар (посилання на `Doctor`, опційно)          |
| timezone          | string   | Часовий пояс користувача (для нагадувань)                |
| preferredLanguage | string   | Мова інтерфейсу / комунікації                            |
| createdAt         | datetime | Дата створення профілю                                   |
| updatedAt         | datetime | Дата останнього оновлення                                |

---

## 3. Модель `Doctor` (профіль лікаря)

| Назва властивості | Тип      | Опис                                                  |
| ----------------- | -------- | ----------------------------------------------------- |
| id                | objectId | Унікальний ідентифікатор профілю лікаря               |
| userId            | objectId | Посилання на `User`                                   |
| fullName          | string   | Повне ім’я лікаря                                     |
| specialization    | string   | Спеціалізація (невролог, психіатр тощо)               |
| clinic            | string   | Назва клініки / закладу                               |
| phone             | string   | Контактний номер телефону                             |
| email             | string   | Робочий email                                         |
| doctorCode        | string   | Код підключення пацієнта до лікаря                    |
| workingHours      | string   | Опис робочих годин (можна винести в окрему структуру) |
| createdAt         | datetime | Дата створення профілю                                |
| updatedAt         | datetime | Дата останнього оновлення                             |

---

## 4. Модель `ChronicCondition` (хронічні захворювання)

| Назва властивості | Тип      | Опис                                           |
| ----------------- | -------- | ---------------------------------------------- |
| id                | objectId | Унікальний ідентифікатор запису                |
| patientId         | objectId | Посилання на `Patient`                         |
| name              | string   | Назва діагнозу (наприклад, “Хронічна мігрень”) |
| sinceDate         | date     | З якої дати відомий діагноз                    |
| stage             | string   | Стадія / ступінь (опційно)                     |
| notes             | string   | Додаткові коментарі                            |
| treatingPhysician | string   | Лікуючий лікар (текстово)                      |
| visibleToDoctor   | boolean  | Чи може закріплений лікар бачити цей запис     |
| isActive          | boolean  | Чи актуальний діагноз                          |
| createdAt         | datetime | Дата створення                                 |
| updatedAt         | datetime | Дата оновлення                                 |

---

## 5. Модель `Allergy` (алергії пацієнта)

| Назва властивості | Тип      | Опис                                                 |
| ----------------- | -------- | ---------------------------------------------------- |
| id                | objectId | Унікальний ідентифікатор                             |
| patientId         | objectId | Посилання на `Patient`                               |
| substance         | string   | Речовина / препарат (наприклад, “Ibuprofen”)         |
| reaction          | string   | Опис реакції (кропив’янка, анафілаксія, нудота тощо) |
| severity          | enum     | `LOW`, `MODERATE`, `HIGH`                            |
| notes             | string   | Додаткові коментарі                                  |
| visibleToDoctor   | boolean  | Чи бачить лікар цю алергію                           |
| createdAt         | datetime | Дата створення                                       |
| updatedAt         | datetime | Дата оновлення                                       |

---

## 6. Модель `SpecialConsiderations` (особливі застереження)

| Назва властивості            | Тип      | Опис                                                                    |
| ---------------------------- | -------- | ----------------------------------------------------------------------- |
| id                           | objectId | Унікальний ідентифікатор                                                |
| patientId                    | objectId | Посилання на `Patient`                                                  |
| religiousRestrictions        | string[] | Список релігійних/етичних обмежень (наприклад, “no_pork”, “no_alcohol”) |
| religiousNote                | string   | Текстовий опис релігійних / етичних обмежень                            |
| dietRestrictions             | string[] | Дієтичні обмеження (`vegan`, `halal`, `kosher`, `gluten_free` тощо)     |
| otherRestrictions            | string   | Інші важливі застереження                                               |
| pregnancyStatus              | enum     | `NONE`, `PREGNANT`, `LACTATION`, `PLANNING`, `UNKNOWN`                  |
| consentUseForRecommendations | boolean  | Згода використовувати ці дані для рекомендацій                          |
| visibleToDoctor              | boolean  | Чи бачить лікар повний блок застережень                                 |
| createdAt                    | datetime | Дата створення                                                          |
| updatedAt                    | datetime | Дата оновлення                                                          |

---

## 7. Модель `Medication` (препарати)

| Назва властивості | Тип      | Опис                                              |
| ----------------- | -------- | ------------------------------------------------- |
| id                | objectId | Унікальний ідентифікатор препарату                |
| patientId         | objectId | Посилання на `Patient`                            |
| name              | string   | Назва препарату                                   |
| dosageDescription | string   | Опис дози (наприклад, “50 мг двічі на день”)      |
| form              | string   | Форма (таблетки, краплі, ін’єкція тощо)           |
| notes             | string   | Примітки (коли приймати, залежність від їжі тощо) |
| isActive          | boolean  | Чи актуальний препарат                            |
| createdAt         | datetime | Дата створення                                    |
| updatedAt         | datetime | Дата оновлення                                    |

---

## 8. Модель `MedicationReminder` (нагадування про прийом ліків)

| Назва властивості | Тип      | Опис                                  |
| ----------------- | -------- | ------------------------------------- |
| id                | objectId | Унікальний ідентифікатор нагадування  |
| patientId         | objectId | Посилання на `Patient`                |
| medicationId      | objectId | Посилання на `Medication`             |
| timeOfDay         | string   | Час доби (наприклад, `08:00`)         |
| daysOfWeek        | number[] | Дні тижня (0–6 або 1–7)               |
| startDate         | date     | Початок дії нагадування               |
| endDate           | date     | Кінець дії (опційно)                  |
| timezone          | string   | Часовий пояс для розрахунку сповіщень |
| isActive          | boolean  | Чи активне нагадування                |
| lastTakenAt       | datetime | Остання відмітка “прийняв”            |
| createdAt         | datetime | Дата створення                        |
| updatedAt         | datetime | Дата оновлення                        |

---

## 9. Модель `MoodEntry` (щоденний емоційний стан)

| Назва властивості | Тип      | Опис                                                   |
| ----------------- | -------- | ------------------------------------------------------ |
| id                | objectId | Унікальний ідентифікатор                               |
| patientId         | objectId | Посилання на `Patient`                                 |
| date              | date     | Дата, до якої належить запис                           |
| moodScore         | number   | Оцінка настрою (відповідає позиції повзунка смайликів) |
| moodScaleType     | enum     | Тип шкали, наприклад, `EMOJI_SLIDER`                   |
| comment           | string   | Коментар користувача (“чому так себе почуваю”)         |
| createdAt         | datetime | Дата створення                                         |
| updatedAt         | datetime | Дата оновлення                                         |

---

## 10. Модель `MigraineAttack` (напад головного болю / мігрені)

| Назва властивості     | Тип      | Опис                                                                                                       |
| --------------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id                    | objectId | Унікальний ідентифікатор нападу                                                                            |
| patientId             | objectId | Посилання на `Patient`                                                                                     |
| startDateTime         | datetime | Час початку нападу                                                                                         |
| endDateTime           | datetime | Час завершення нападу (може бути null, якщо триває)                                                        |
| durationMinutes       | number   | Тривалість у хвилинах (кешоване значення)                                                                  |
| intensityVAS          | number   | Інтенсивність болю за ВАШ (0–10)                                                                           |
| headacheLocations     | string[] | Локалізація болю в голові (`FOREHEAD`, `TEMPORAL`, `OCCIPITAL`, `ONE_SIDE`, `BOTH_SIDES`, `EYES`, `OTHER`) |
| otherBodyPainLocation | string   | Біль в інших ділянках тіла (текстове поле)                                                                 |
| suspectedTriggers     | string[] | Ймовірні тригери (стрес, недосип, погода, менструація тощо)                                                |
| auraPresent           | boolean  | Чи була аура                                                                                               |
| auraTypes             | string[] | Типи аури (зорові, сенсорні, мовні, моторні)                                                               |
| additionalSymptoms    | string[] | Супутні симптоми (нудота, світлобоязнь, фонофобія тощо)                                                    |
| mcgillCompleted       | boolean  | Чи заповнений опитувальник Мак-Гілла для цього нападу                                                      |
| mcgillPainProfile     | string   | Короткий опис типу болю за Мак-Гіллом (наприклад, “пульсуючий, виснажливий”)                               |
| isRedFlag             | boolean  | Чи розпізнано “червоні прапорці” для цього нападу                                                          |
| redFlags              | string[] | Які саме red flags спрацювали (коди або текстові ярлики)                                                   |
| createdAt             | datetime | Дата створення запису                                                                                      |
| updatedAt             | datetime | Дата оновлення                                                                                             |

---

## 11. Модель `QuestionnaireTemplate` (шаблон опитувальника)

| Назва властивості | Тип      | Опис                                                           |
| ----------------- | -------- | -------------------------------------------------------------- |
| id                | objectId | Унікальний ідентифікатор                                       |
| code              | string   | Системний код (`PHQ9`, `GAD7`, `MCGILL`, `MIDAS`, `HIT6` тощо) |
| title             | string   | Назва опитувальника                                            |
| description       | string   | Короткий опис                                                  |
| periodicity       | enum     | `DAILY`, `WEEKLY`, `MONTHLY`, `ON_DEMAND`                      |
| targetCondition   | string   | Для яких станів / діагнозів рекомендований                     |
| isActive          | boolean  | Чи використовується зараз у застосунку                         |
| createdAt         | datetime | Дата створення                                                 |
| updatedAt         | datetime | Дата оновлення                                                 |

---

## 12. Модель `QuestionnaireQuestion` (питання опитувальника)

| Назва властивості | Тип      | Опис                                                                          |
| ----------------- | -------- | ----------------------------------------------------------------------------- |
| id                | objectId | Унікальний ідентифікатор                                                      |
| questionnaireId   | objectId | Посилання на `QuestionnaireTemplate`                                          |
| order             | number   | Порядковий номер питання                                                      |
| text              | string   | Текст питання                                                                 |
| answerType        | enum     | Тип відповіді: `LIKERT_0_3`, `LIKERT_0_4`, `DESCRIPTOR_LIST`, `VAS_0_10` тощо |
| options           | string[] | Варіанти відповіді (якщо це шкала/список)                                     |
| createdAt         | datetime | Дата створення                                                                |
| updatedAt         | datetime | Дата оновлення                                                                |

---

## 13. Модель `QuestionnaireResponse` (відповідь на опитувальник)

| Назва властивості | Тип      | Опис                                         |
| ----------------- | -------- | -------------------------------------------- |
| id                | objectId | Унікальний ідентифікатор                     |
| patientId         | objectId | Посилання на `Patient`                       |
| questionnaireId   | objectId | Посилання на `QuestionnaireTemplate`         |
| doctorId          | objectId | Лікар, який призначив опитувальник (опційно) |
| startedAt         | datetime | Час початку заповнення                       |
| completedAt       | datetime | Час завершення                               |
| answers           | json     | Масив відповідей (питання → обране значення) |
| totalScore        | number   | Сумарний бал (PHQ-9, GAD-7 тощо)             |
| severityLevel     | string   | Інтерпретація (“легка”, “помірна”, “важка”)  |
| redFlagsDetected  | boolean  | Чи були red flags в цьому опитувальнику      |
| redFlags          | string[] | Список кодів / описів прапорців              |
| createdAt         | datetime | Дата створення                               |
| updatedAt         | datetime | Дата оновлення                               |

---

## 14. Модель `Appointment` (запис на прийом)

| Назва властивості | Тип      | Опис                                                           |
| ----------------- | -------- | -------------------------------------------------------------- |
| id                | objectId | Унікальний ідентифікатор                                       |
| patientId         | objectId | Посилання на `Patient`                                         |
| doctorId          | objectId | Посилання на `Doctor`                                          |
| requestedBy       | enum     | Хто ініціював: `PATIENT` або `DOCTOR`                          |
| status            | enum     | `REQUESTED`, `CONFIRMED`, `DECLINED`, `CANCELLED`, `COMPLETED` |
| requestedAt       | datetime | Коли був створений запит                                       |
| scheduledStart    | datetime | Запланований початок консультації                              |
| scheduledEnd      | datetime | Запланований кінець консультації                               |
| locationType      | enum     | `ONLINE`, `OFFLINE`, `PHONE`                                   |
| patientComment    | string   | Коментар пацієнта при записі                                   |
| doctorComment     | string   | Коментар лікаря                                                |
| createdAt         | datetime | Дата створення                                                 |
| updatedAt         | datetime | Дата оновлення                                                 |
